---
title: "Movielens"
author: "Jordy Veuger"
date: "6/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Movielens Capstone

1. Introduction
The purpose of this R project is to try to create a model that predicts what rating a user will give to a movie. Or in other words, it predicts the user preference for a certain movie. As validation of the model we will use RMSE (Root Mean Square Error).

The most famoust recommender event was originally a Netflix competetion with the following goal: Whoever improves our recommendation engine with 10% wins a million dollars.

1.1 The approach
The goal of the project is to establish an algorithm with a RMSE of 0.87750 or lower.

In order to reach this goal, the following steps were taken:
Explored the data set
Split the data set into a training set (9,000,055 observations) and a test set (999,999 observations).
Apply different methods to improve the algorithm until it produced an RMSE of 0.87750 or lower.
Test the algorithm on the Test (validation) set.
Compare RMSEs between training and test set to verify the model.

2. The Dataset.

In the provided data set we find 10,000,054 observations of 6 variables.
List of variables.
userId: Identification number for each user.
movieId: Identification number for each movie.
timestamp: Date and time at which each rating was recorded.
title: Title of each movie.
genres: Movie genre which each movie is classified as.
rating: Rating between 0 and 5 with intervals of 0.5 for each movie.

This is the code provided by edx.
```{r Provided code}
# Provided code
if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(caret)) install.packages("caret", repos = "http://cran.us.r-project.org")

# MovieLens 10M dataset:
# https://grouplens.org/datasets/movielens/10m/
# http://files.grouplens.org/datasets/movielens/ml-10m.zip

dl <- tempfile()
download.file("http://files.grouplens.org/datasets/movielens/ml-10m.zip", dl)

ratings <- read.table(text = gsub("::", "\t", readLines(unzip(dl, "ml-10M100K/ratings.dat"))),
                      col.names = c("userId", "movieId", "rating", "timestamp"))

movies <- str_split_fixed(readLines(unzip(dl, "ml-10M100K/movies.dat")), "\\::", 3)
colnames(movies) <- c("movieId", "title", "genres")
movies <- as.data.frame(movies) %>% mutate(movieId = as.numeric(levels(movieId))[movieId],
                                           title = as.character(title),
                                           genres = as.character(genres))

movielens <- left_join(ratings, movies, by = "movieId")

# Validation set will be 10% of MovieLens data

set.seed(1, sample.kind = "Rounding")
test_index <- createDataPartition(y = movielens$rating, times = 1, p = 0.1, list = FALSE)
edx <- movielens[-test_index,]
temp <- movielens[test_index,]

# Make sure userId and movieId in validation set are also in edx set

validation <- temp %>% 
  semi_join(edx, by = "movieId") %>%
  semi_join(edx, by = "userId")

# Add rows removed from validation set back into edx set

removed <- anti_join(temp, validation)
edx <- rbind(edx, removed)
```


3. Exploratory Analysis.
Alot of the exploratory analysis has already been done in order to answer the question on the Quiz in the course material. However I will try to visualize some of the data from the original data set to paint a better picture of what the set lookslike and how it's distributed.

Printing the head of the data set to see what it looks like.
```{r Head edx}
head(edx)
```
Plot the Distribution of ratings
```{r Distribution of ratings}
edx %>% ggplot(aes(rating)) +
geom_bar(color = "Blue")
  labs(title = "Distribution of Ratings",
       x = "Rating",
       y = "Frequency")
```

An overview of the metrics per genre shows us how the data set is distributed by genre.
```{r Metrics per Genre}
edx_metrics_perGenre <- edx %>%
  separate_rows(genres, sep = "\\|") %>%
  group_by(genres) %>%
  summarize(Total_ratings_perGenre = n(), Avarage_ratings_perGenre = mean(rating), 
            Total_movies_perGenre = n_distinct(movieId),Total_users_perGenre = n_distinct(userId))
edx_metrics_perGenre
```

Plot the Total ratings per genre
```{r Total ratings per genre, echo=FALSE}
edx_metrics_perGenre %>%
ggplot(aes(x = reorder(genres, -Total_ratings_perGenre), 
           y = Total_ratings_perGenre, fill = genres, label = Total_ratings_perGenre)) +
geom_col() + 
geom_text(aes(label = Total_ratings_perGenre), angle = 90, 
          color = "white", size = 3, check_overlap = T, position = position_stack((vjust = 0.5))) + 
labs(title = "Total ratings per genre", x = "Genres", y = "Total ratings") +theme(axis.text.x = element_text(angle = 90))
```


